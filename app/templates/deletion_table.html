<div class="glass-panel p-4 rounded-lg shadow-xl">
    <div class="overflow-x-auto overflow-y-hidden">
        <table class="min-w-full border-separate border-spacing-y-1">
            <thead class="sticky top-0 z-10 bg-gray-900/95 backdrop-blur-sm">
                <tr>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider w-10 rounded-l-lg">
                        <input type="checkbox" id="select-all" class="mass-edit-checkbox hidden w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500 focus:ring-2">
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Poster</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">
                        {% set next_order = 'desc' if sort_by == 'title' and sort_order == 'asc' else 'asc' %}
                        <a href="{{ url_for(request.endpoint, sort_by='title', sort_order=next_order) }}" class="cursor-pointer hover:text-white flex items-center group">
                            Title
                            <span class="ml-1 text-gray-600 group-hover:text-gray-400 transition-colors">
                                {% if sort_by == 'title' %}
                                    {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
                                {% else %}↕{% endif %}
                            </span>
                        </a>
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">
                        {% set next_order = 'desc' if sort_by == 'size_gb' and sort_order == 'asc' else 'asc' %}
                        <a href="{{ url_for(request.endpoint, sort_by='size_gb', sort_order=next_order) }}" class="cursor-pointer hover:text-white flex items-center group">
                            Size
                            <span class="ml-1 text-gray-600 group-hover:text-gray-400 transition-colors">
                                {% if sort_by == 'size_gb' %}
                                    {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
                                {% else %}↕{% endif %}
                            </span>
                        </a>
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">
                        {% set next_order = 'desc' if sort_by == 'marked_for_deletion_at' and sort_order == 'asc' else 'asc' %}
                        <a href="{{ url_for(request.endpoint, sort_by='marked_for_deletion_at', sort_order=next_order) }}" class="cursor-pointer hover:text-white flex items-center group">
                            Deletes In
                            <span class="ml-1 text-gray-600 group-hover:text-gray-400 transition-colors">
                                {% if sort_by == 'marked_for_deletion_at' %}
                                    {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
                                {% else %}↕{% endif %}
                            </span>
                        </a>
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider rounded-r-lg">Actions</th>
                </tr>
            </thead>
            <tbody class="space-y-2">
                {% for item in items %}
                <tr class="group bg-white/5 hover:bg-white/10 transition-all duration-200 animate-fade-in-up relative hover:z-50" style="animation-delay: {{ loop.index0 * 30 }}ms">
                    <td class="px-6 py-4 whitespace-nowrap rounded-l-lg border-y border-l border-white/5 group-hover:border-white/10">
                        <input type="checkbox" class="mass-edit-checkbox hidden w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500 focus:ring-2" value="{{ item.id }}" data-media-type="{{ media_type }}">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap relative border-y border-white/5 group-hover:border-white/10">
                        <div class="relative w-10 h-[60px] bg-gray-700 rounded shadow-md overflow-hidden">
                            <img src="{{ url_for('static', filename=item.local_poster_path) if item.local_poster_path else 'https://placehold.co/50x75/111827/4b5563?text=N/A' }}" 
                                 alt="{{ item.title }} poster" 
                                 loading="lazy"
                                 class="w-full h-full object-cover">
                        </div>
                        <!-- Hover Card -->
                        <div class="absolute top-0 left-full ml-4 w-[24rem] bg-gray-900 p-4 rounded-xl shadow-2xl opacity-0 group-hover:opacity-100 transition-all duration-300 pointer-events-none z-50 flex items-start border border-white/10 translate-x-[-10px] group-hover:translate-x-0 whitespace-normal">
                            <img src="{{ url_for('static', filename=item.local_poster_path) if item.local_poster_path else 'https://placehold.co/150x225/111827/4b5563?text=N/A' }}" class="w-32 h-auto rounded-lg shadow-lg mr-4 flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-white text-lg leading-tight">{{ item.title }}</h4>
                                <div class="flex items-center gap-2 mt-1 mb-2">
                                    <span class="text-xs font-medium px-2 py-0.5 rounded bg-gray-700 text-gray-300">{{ item.year }}</span>
                                    <span class="text-xs font-medium text-gray-400">{{ "%.2f"|format(item.size_gb) }} GB</span>
                                </div>
                                <p class="text-sm text-gray-300 leading-relaxed">{{ item.overview or 'No summary available.' }}</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap border-y border-white/5 group-hover:border-white/10">
                        <div class="text-sm font-medium text-white">{{ item.title }}</div>
                        <div class="text-xs text-gray-500">{{ item.year }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-400 border-y border-white/5 group-hover:border-white/10">{{ "%.2f"|format(item.size_gb) }} GB</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400 border-y border-white/5 group-hover:border-white/10">
                        {% if item.delete_at %}
                            {% set remaining = item.delete_at.replace(tzinfo=None) - now.replace(tzinfo=None) %}
                            {% if remaining.total_seconds() > 0 %}
                                <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-yellow-400/10 text-yellow-400 ring-1 ring-inset ring-yellow-400/20">
                                    {% if remaining.days > 0 %}
                                        {{ remaining.days }} days
                                    {% else %}
                                        {{ (remaining.seconds // 3600) | int }} hours
                                    {% endif %}
                                </span>
                            {% else %}
                                <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-red-400/10 text-red-400 ring-1 ring-inset ring-red-400/20">Expired</span>
                            {% endif %}
                        {% else %}
                            <span class="text-gray-500">N/A</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium rounded-r-lg border-y border-r border-white/5 group-hover:border-white/10">
                        <div class="flex items-center gap-2">
                            <a href="{{ url_for('media_action', media_type=media_type, media_id=item.id, action='keep') }}" class="p-1.5 rounded-lg text-green-400 hover:bg-green-400/10 transition-colors" title="Keep Media">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 0 1 0 1.414l-8 8a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L8 12.586l7.293-7.293a1 1 0 0 1 1.414 0z" clip-rule="evenodd" /></svg>
                            </a>
                            <a href="{{ url_for('delete_media', media_type=media_type, media_id=item.id) }}" class="p-1.5 rounded-lg text-red-400 hover:bg-red-400/10 transition-colors" title="Delete Now">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

